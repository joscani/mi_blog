---
title: Big data para pobres II. ¿AUC?
author: jlcr
date: '2021-05-21'
slug: big-data-pobres-ii-auc
categories:
  - estadística
tags:
  - big data
  - estadística
description: ''
topics: []
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>
<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/datatables-binding/datatables.js"></script>
<link href="/rmarkdown-libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="/rmarkdown-libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="/rmarkdown-libs/dt-core/js/jquery.dataTables.min.js"></script>
<link href="/rmarkdown-libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/crosstalk/js/crosstalk.min.js"></script>


<p>Bueno, pues voy a ampliar el ejemplo del <a href="https://muestrear-no-es-pecado.netlify.app/2021/05/14/cosas-viejunas-o-big-data-para-pobres/">último día</a>, como es viernes, estoy cansado y me iré a tomar una birra pronto, intentaré ser breve.</p>
<p>Levantamos una sesión de spark y leemos los mismos datos del otro día. Ya de paso voy a probar el operador pipe nativo en R base <code>|&gt;</code>. Si tienes la nueva versión de R instalada y la versión de Rstudio preview, en global options puedes poner para que al hacer Ctrl + Shift +M aparezca el nuevo operador o el antiguo.</p>
<pre class="r"><code>library(tidyverse)
library(sparklyr)

sc &lt;- spark_connect(master = &quot;local&quot;)

tmp &lt;- sc |&gt; 
  spark_read_parquet(path = here::here(&quot;data/bd_pobres.parquet&quot; ))</code></pre>
<pre class="r"><code># en el nuevo operador es necesario el paréntesis. 
tmp |&gt; head()</code></pre>
<pre><code>## # Source: spark&lt;?&gt; [?? x 4]
##   valor_cliente  edad segmento tipo 
##           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;
## 1             3    79 No_way   B    
## 2             3    79 No_way   B    
## 3             3    79 No_way   B    
## 4             3    79 No_way   B    
## 5             3    79 No_way   B    
## 6             3    79 No_way   B</code></pre>
<p>Discretizamos la edad.</p>
<pre class="r"><code>df_spark &lt;-  tmp |&gt; 
  mutate(
         edad_cat = case_when(
           edad &lt;= 20 ~ &quot;&lt;21&quot;,
           edad &lt;= 40 ~ &quot;21- 40&quot;,
           edad &lt;= 50 ~ &quot;41-50&quot;, 
           edad &lt;= 60 ~ &quot;40-60&quot;,
           edad &gt; 60 ~ &quot;&gt;60&quot;
         )
         )

head(df_spark)</code></pre>
<pre><code>## # Source: spark&lt;?&gt; [?? x 5]
##   valor_cliente  edad segmento tipo  edad_cat
##           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;   
## 1             3    79 No_way   B     &gt;60     
## 2             3    79 No_way   B     &gt;60     
## 3             3    79 No_way   B     &gt;60     
## 4             3    79 No_way   B     &gt;60     
## 5             3    79 No_way   B     &gt;60     
## 6             3    79 No_way   B     &gt;60</code></pre>
<p>Y ahora vamos a crear conjunto de train y de test</p>
<pre class="r"><code>particiones &lt;-  df_spark |&gt; sdf_random_split(training = 0.6, test = 0.4)

train &lt;- particiones$training
test &lt;- particiones$test </code></pre>
<p>Y ahora procedemos a agregar los datos y traerlos a local. Y seguro que alguno se pregunta ¿por qué no haces el modelo en spark?. Podría hacerlo, ya he contado en este blog como hacer modelos usando sparkling water por ejemplo, pero podría querer ajustar un tipo de modelo que no esté en distribuido, no sé, un modelo mixto con <code>glmer</code> o con <code>stan</code> . De hecho es eso lo que voy a hacer, un <code>glmer</code>.</p>
<pre class="r"><code>train_local &lt;- train |&gt;
  group_by(segmento,
           tipo,
           valor_cliente,
           edad_cat) |&gt;
  count()  |&gt;
  collect() |&gt; 
  # ponemos las variables categóricas a tipo factor
  mutate(across(where(is.character), as_factor))

DT::datatable(train_local)</code></pre>
<div id="htmlwidget-1" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427","428","429","430","431","432","433","434","435","436","437","438","439","440","441","442","443","444","445","446","447","448","449","450","451","452","453","454","455","456","457","458","459","460","461","462","463","464","465","466","467","468","469","470","471","472","473","474","475","476","477","478","479","480","481","482","483","484","485","486","487","488","489","490","491","492","493","494","495","496","497","498","499","500","501","502","503","504","505","506","507","508","509","510","511","512","513","514","515","516","517","518","519","520","521","522","523","524","525","526","527","528","529","530","531","532","533","534","535","536","537","538","539","540","541","542","543","544","545","546","547","548","549","550","551","552","553","554","555","556","557","558","559","560","561","562","563","564","565","566","567","568","569","570","571","572","573","574","575","576","577","578","579","580","581","582","583","584","585","586","587","588","589","590","591","592","593","594","595","596","597","598","599","600","601","602","603","604","605","606","607","608","609","610","611","612","613","614","615","616","617","618","619","620","621","622","623","624","625","626","627","628","629","630","631","632","633","634","635","636","637","638","639","640","641","642","643","644","645","646","647","648","649","650","651","652","653","654","655","656","657","658","659","660","661","662","663","664","665","666","667"],["Rec","Best","Neut","Rec","Neut","Best","Neut","Neut","Neut","Rec","Best","No_way","No_way","Best","No_way","Rec","No_way","Rec","Best","Rec","No_way","Rec","Best","Best","Best","Neut","Neut","Best","Best","Best","No_way","Neut","Best","Best","No_way","Best","Rec","No_way","No_way","No_way","Rec","Best","Rec","No_way","Best","Neut","Rec","Rec","Best","No_way","Best","Rec","Rec","No_way","Neut","Best","Neut","Neut","Rec","Neut","Neut","Neut","No_way","Rec","Best","Best","Best","Best","Neut","Neut","No_way","Best","Neut","Rec","Best","Neut","No_way","Best","Neut","No_way","Rec","Neut","Best","Neut","Best","No_way","Rec","No_way","Neut","Rec","Rec","No_way","Neut","Best","Best","Neut","Best","Neut","Best","Best","Neut","Neut","Rec","No_way","Rec","Best","Best","No_way","Best","Rec","Rec","Neut","No_way","No_way","Best","Neut","Rec","Rec","Best","No_way","Rec","Neut","No_way","Neut","Rec","Neut","Best","Neut","Best","Neut","Best","Rec","Best","No_way","Rec","Neut","No_way","Rec","Neut","Rec","Neut","Best","No_way","Rec","Best","Rec","Best","Neut","No_way","Neut","No_way","Best","Best","Neut","No_way","Neut","Neut","Best","Rec","Neut","No_way","Rec","Best","Rec","Best","Rec","No_way","Neut","No_way","Best","No_way","Rec","Best","Rec","Neut","Rec","Rec","Best","Best","No_way","No_way","Rec","Rec","Best","Best","Neut","Neut","No_way","No_way","Rec","Neut","Rec","Rec","Best","No_way","Best","Best","Rec","Rec","No_way","Neut","No_way","No_way","Neut","No_way","Rec","Neut","No_way","Rec","No_way","No_way","No_way","Neut","Rec","No_way","Best","Best","Rec","Rec","Rec","No_way","Neut","Neut","Rec","Neut","Rec","Neut","Best","Neut","Neut","Best","No_way","No_way","No_way","Rec","Best","No_way","Best","Rec","Rec","No_way","Best","Neut","Neut","Best","Neut","Rec","No_way","No_way","Neut","Neut","Rec","Neut","Neut","Rec","Rec","No_way","Best","Rec","Best","Rec","No_way","Rec","No_way","Best","Rec","No_way","No_way","Best","No_way","Rec","Rec","Best","Rec","Best","Best","Neut","No_way","No_way","Neut","No_way","Best","Neut","Rec","Best","Neut","No_way","No_way","Best","No_way","Best","No_way","Rec","No_way","No_way","No_way","Rec","No_way","Best","No_way","No_way","Best","Neut","No_way","Rec","No_way","Best","Rec","Rec","Rec","Neut","Neut","Neut","Rec","Neut","Rec","No_way","No_way","Best","No_way","Best","Best","No_way","No_way","Best","No_way","Rec","Best","Best","Neut","Best","Neut","Neut","Rec","Neut","Rec","No_way","Best","Neut","Best","Neut","Neut","Rec","No_way","Best","Neut","No_way","Best","Neut","Rec","Rec","Neut","Rec","Rec","Rec","No_way","Best","Neut","Rec","Best","Neut","Rec","Neut","No_way","Neut","No_way","No_way","Rec","No_way","Rec","Rec","No_way","Neut","Best","No_way","Best","No_way","Rec","Neut","Rec","Best","Neut","No_way","No_way","No_way","Best","Best","Neut","Neut","Neut","No_way","Neut","No_way","No_way","No_way","Rec","Rec","No_way","No_way","No_way","Best","Best","Neut","Best","Neut","No_way","Rec","Best","Neut","No_way","Best","No_way","Neut","No_way","Neut","Neut","No_way","Rec","No_way","Rec","Rec","Rec","Best","Rec","No_way","Rec","Rec","Best","Neut","Best","No_way","Neut","No_way","Neut","No_way","Best","Best","No_way","No_way","Best","Rec","Neut","Rec","Neut","No_way","Best","No_way","Neut","Neut","Best","Neut","Neut","No_way","Neut","No_way","No_way","Best","Neut","Rec","Rec","Neut","Rec","Rec","Neut","Best","Best","Best","Neut","Rec","Best","Neut","Rec","Rec","Best","Best","Neut","Neut","Neut","Best","No_way","Neut","Best","Neut","Neut","Best","Neut","Neut","Rec","Neut","Best","No_way","Best","Neut","No_way","Best","No_way","No_way","No_way","Neut","Best","Best","Neut","Rec","Rec","Rec","Best","Best","Neut","No_way","Rec","No_way","Best","Best","Neut","No_way","No_way","No_way","No_way","Rec","No_way","No_way","No_way","No_way","Neut","Neut","Rec","Best","Best","Rec","Neut","Neut","Best","Rec","No_way","Rec","Neut","Best","Best","Neut","Rec","No_way","Rec","Neut","Neut","Rec","Neut","No_way","Best","Rec","Neut","Neut","Neut","Neut","No_way","No_way","Rec","Neut","Neut","Best","Rec","No_way","Best","Neut","Best","Rec","Neut","Neut","Neut","Best","Rec","Neut","Neut","Rec","Best","Neut","Rec","Neut","Neut","No_way","Neut","Neut","No_way","Best","Neut","Neut","No_way","Rec","No_way","Neut","Rec","Best","No_way","Best","Best","Neut","Best","No_way","No_way","Neut","Best","No_way","Best","Best","No_way","Best","Best","Neut","No_way","Rec","Best","No_way","Best","No_way","No_way","Rec","No_way","No_way","Best","Neut","No_way","No_way","No_way","No_way","Best","Best","Best","No_way","No_way","Rec","Neut","Neut","Rec","Best","Best","Rec","No_way","Best","No_way","Rec","Neut","Best","Neut","No_way","Best","No_way","Best","Best","No_way","Best","Rec","No_way","No_way","Best","Best","Best","Neut","No_way","Best","No_way","Neut","No_way","Rec","Neut","Neut","Best","Neut","Rec"],["C","B","SM","B","SM","SM","SF","B","SF","SM","SF","C","SM","SM","C","C","SM","SM","B","SF","B","SF","SF","C","SF","C","C","C","B","SM","B","SM","B","C","SF","SF","C","SM","SF","C","C","B","C","SM","C","C","C","C","SM","SM","SM","SF","SM","SM","SF","B","C","B","C","SM","SM","SF","SF","B","C","SM","C","SM","SM","C","C","SM","B","C","C","B","SM","C","SF","SF","SF","SF","SM","SM","SF","C","B","C","C","SF","SM","C","C","SM","SM","C","SM","SM","SF","SF","SM","SM","C","B","B","SF","C","SM","B","C","SM","SF","B","C","C","SF","C","SF","SF","C","C","C","SF","SM","SF","SM","SF","SF","SM","SM","SM","C","SM","SM","B","SF","SM","SM","B","SM","SF","C","SF","SF","C","C","SF","SM","SM","SM","SM","C","B","SF","C","SF","C","C","B","C","C","B","B","SF","B","SF","SF","C","B","SM","C","C","SF","C","C","C","B","SF","C","C","SF","C","SF","B","C","SM","SF","B","SM","SF","SF","B","SF","C","SM","C","B","SF","B","SM","SM","C","C","C","C","SF","B","SF","C","SM","SF","C","B","B","B","C","SF","C","SF","SM","SM","SF","SF","B","B","B","SM","SF","B","SM","B","SM","B","C","SF","B","SF","B","C","SM","C","B","B","SM","SM","SM","SF","C","SM","B","C","C","SM","C","B","C","B","C","SF","C","B","SM","B","SF","SM","B","SF","SM","B","B","C","C","SM","SM","SF","SM","C","SF","SM","SM","SM","SF","B","SM","B","SF","SM","B","C","SM","C","SF","C","SF","B","C","SF","B","C","SF","SF","C","B","SF","C","B","SF","C","B","B","SF","B","SF","SF","C","C","B","SF","SM","SF","SF","SM","B","C","B","SF","SM","B","SF","SM","SM","SF","SM","C","SM","SF","SF","C","B","B","B","C","C","SF","SM","C","C","C","SM","SM","B","SF","B","C","C","SM","C","SF","B","SF","B","SF","SF","C","C","SF","SM","B","SF","B","C","SF","SM","SM","B","SF","SM","C","SM","B","SF","SF","SF","B","C","C","SF","SF","C","SF","SF","C","C","B","SM","C","SF","B","SF","SF","B","SM","B","SM","B","SF","B","SF","C","SM","B","C","C","SM","B","SM","B","B","B","SM","B","C","SM","C","SM","B","SF","SF","SF","SM","B","SM","B","B","SF","SM","B","C","SF","SF","B","C","SF","C","B","C","SF","B","B","SM","SM","B","SM","B","C","SF","SM","C","B","SM","B","SM","SF","SM","C","SF","C","C","B","B","SF","B","SF","C","C","C","B","C","B","B","SM","C","C","SF","SM","C","SF","C","SF","SM","SM","C","SF","B","B","SF","SM","SM","B","SF","SM","C","B","SF","B","B","SF","C","B","B","SF","B","SF","SM","B","C","SF","SM","B","B","B","C","C","B","C","SM","SF","SM","SM","SM","C","B","SM","B","C","C","B","C","B","SM","C","SM","C","SM","SM","B","B","B","SF","SF","C","SM","C","B","SM","SF","C","SM","SF","SF","B","C","SM","SM","C","B","SM","C","C","B","B","SF","SF","SF","SF","SM","SM","SF","B","B","C","SM","SM","B","SM","C","C","SM","B","SF","SF","C","SF","B","C","C","SM","C","SF","SF","B","B","C","SM","C","SF","B","C","SF","C","B","B","SF","B","B","C","C","C","SF","B","C","SF","SM","B","SF","SM","B","SM","SF","B","C","C","SF","SM","SM","SF","SM","SM","B","SM","B","SF","C","SF","SF","SF","SM","C","B","SM","SF","SM","SF","B","SF","B","C","B","SF","B","C","C","SF","B","C","B","C"],[0,0,0,0,0,0,1,1,2,2,2,2,2,2,2,2,3,3,4,4,4,4,5,5,5,5,6,6,6,6,6,6,7,7,7,7,7,7,8,8,8,8,9,0,0,0,0,1,1,1,1,1,1,1,1,3,2,2,2,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,4,5,5,5,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,8,8,8,0,0,0,0,1,1,1,1,1,2,2,2,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,6,6,6,7,7,7,7,8,8,8,8,8,9,0,0,0,0,0,0,1,1,1,1,1,1,2,2,2,2,2,2,2,3,3,3,4,4,4,4,4,5,5,5,5,5,6,6,6,6,6,6,6,7,7,7,7,8,8,8,8,8,8,8,8,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,2,4,2,2,2,2,2,3,3,3,3,4,4,4,4,4,4,4,5,5,5,5,5,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,9,0,0,0,0,0,1,1,1,2,3,2,2,2,2,2,2,2,3,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,6,6,6,6,6,6,7,7,7,7,7,7,7,7,8,8,8,8,8,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,7,7,7,7,7,8,8,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,2,2,3,2,2,2,2,3,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6,6,6,7,7,7,7,7,8,8,8,8,8,9,0,0,0,0,0,0,1,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,4,5,5,5,5,5,5,6,6,6,6,6,6,6,6,7,7,7,7,7,8,8,8,8,8,9,9,0,0,0,1,1,1,1,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,5,5,6,6,6,6,6,6,7,7,7,7,7,8,8,0,0,0,0,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,5,5,5,5,5,5,6,6,6,6,6,6,6,7,7,7,7,7,7,7,8,8,8,8,8,8,8,9],["21- 40","41-50","41-50","41-50","40-60","&gt;60","41-50","&gt;60","&lt;21","21- 40","&lt;21","&lt;21","21- 40","40-60","40-60","&gt;60","41-50","41-50","41-50","41-50","40-60","&gt;60","21- 40","40-60","&gt;60","&gt;60","&lt;21","21- 40","41-50","41-50","40-60","&gt;60","21- 40","21- 40","41-50","40-60","40-60","&gt;60","21- 40","40-60","&gt;60","&gt;60","21- 40","21- 40","41-50","41-50","41-50","&lt;21","21- 40","21- 40","41-50","41-50","41-50","&gt;60","&gt;60","&lt;21","&lt;21","21- 40","21- 40","41-50","40-60","&gt;60","&gt;60","&gt;60","&lt;21","&lt;21","41-50","40-60","40-60","&gt;60","&lt;21","41-50","41-50","41-50","&gt;60","&gt;60","&gt;60","&lt;21","&lt;21","21- 40","21- 40","40-60","&gt;60","&gt;60","21- 40","21- 40","40-60","&gt;60","21- 40","21- 40","40-60","&gt;60","21- 40","21- 40","41-50","41-50","40-60","40-60","&gt;60","&lt;21","&lt;21","&gt;60","&gt;60","&lt;21","&lt;21","21- 40","40-60","40-60","&lt;21","&lt;21","&gt;60","&lt;21","&lt;21","&lt;21","21- 40","21- 40","21- 40","40-60","&gt;60","&gt;60","&gt;60","&lt;21","&lt;21","21- 40","21- 40","41-50","40-60","40-60","&gt;60","&gt;60","&lt;21","21- 40","41-50","40-60","40-60","&gt;60","&gt;60","&gt;60","21- 40","41-50","&gt;60","&lt;21","21- 40","41-50","40-60","&lt;21","21- 40","21- 40","21- 40","41-50","40-60","21- 40","21- 40","21- 40","41-50","40-60","&gt;60","21- 40","21- 40","41-50","41-50","40-60","&gt;60","40-60","21- 40","21- 40","41-50","40-60","40-60","&gt;60","21- 40","41-50","40-60","&lt;21","21- 40","21- 40","41-50","&gt;60","21- 40","41-50","41-50","40-60","40-60","&lt;21","&lt;21","&lt;21","21- 40","21- 40","40-60","40-60","41-50","40-60","40-60","&gt;60","&lt;21","21- 40","21- 40","21- 40","21- 40","40-60","&gt;60","&gt;60","&lt;21","21- 40","21- 40","21- 40","41-50","40-60","40-60","&lt;21","&lt;21","21- 40","41-50","41-50","40-60","&gt;60","&gt;60","&gt;60","41-50","40-60","&lt;21","21- 40","41-50","40-60","&gt;60","&lt;21","21- 40","41-50","41-50","&lt;21","21- 40","21- 40","41-50","40-60","40-60","&gt;60","&lt;21","41-50","41-50","41-50","40-60","21- 40","41-50","41-50","40-60","40-60","&gt;60","21- 40","21- 40","21- 40","41-50","41-50","40-60","&gt;60","&gt;60","&gt;60","&gt;60","41-50","41-50","40-60","40-60","&gt;60","&gt;60","21- 40","21- 40","40-60","&gt;60","&gt;60","&gt;60","21- 40","21- 40","41-50","&lt;21","40-60","21- 40","21- 40","21- 40","21- 40","40-60","&gt;60","&gt;60","&lt;21","21- 40","21- 40","40-60","40-60","40-60","&gt;60","&lt;21","&lt;21","41-50","40-60","40-60","&gt;60","&lt;21","&lt;21","41-50","40-60","&gt;60","&gt;60","&lt;21","40-60","40-60","40-60","40-60","&gt;60","&lt;21","21- 40","21- 40","41-50","40-60","&gt;60","&gt;60","&gt;60","&lt;21","21- 40","40-60","&gt;60","&gt;60","21- 40","40-60","40-60","&gt;60","&gt;60","21- 40","21- 40","21- 40","41-50","41-50","41-50","40-60","40-60","40-60","40-60","&gt;60","&gt;60","&lt;21","21- 40","41-50","40-60","40-60","&gt;60","&lt;21","21- 40","41-50","41-50","41-50","&gt;60","&gt;60","&gt;60","&lt;21","21- 40","40-60","&gt;60","&lt;21","21- 40","41-50","41-50","41-50","40-60","&gt;60","&gt;60","&lt;21","&lt;21","21- 40","21- 40","21- 40","21- 40","41-50","&gt;60","&gt;60","&lt;21","21- 40","41-50","40-60","&gt;60","41-50","40-60","21- 40","21- 40","41-50","41-50","41-50","40-60","40-60","&gt;60","&gt;60","&gt;60","&lt;21","21- 40","41-50","40-60","&gt;60","21- 40","41-50","40-60","21- 40","41-50","41-50","40-60","&gt;60","&gt;60","&lt;21","&lt;21","21- 40","21- 40","21- 40","41-50","41-50","41-50","40-60","&gt;60","&lt;21","&lt;21","21- 40","21- 40","21- 40","21- 40","41-50","40-60","&gt;60","&lt;21","21- 40","21- 40","41-50","41-50","41-50","40-60","40-60","21- 40","21- 40","41-50","41-50","40-60","&gt;60","&gt;60","&gt;60","41-50","41-50","41-50","41-50","40-60","40-60","&gt;60","&gt;60","&lt;21","&lt;21","40-60","&gt;60","&lt;21","&lt;21","21- 40","41-50","40-60","40-60","40-60","&gt;60","&gt;60","&gt;60","&gt;60","&lt;21","41-50","&lt;21","&lt;21","41-50","40-60","&gt;60","&lt;21","21- 40","41-50","41-50","41-50","&lt;21","21- 40","40-60","40-60","&lt;21","21- 40","40-60","&gt;60","21- 40","41-50","41-50","41-50","&gt;60","&gt;60","&lt;21","&lt;21","21- 40","40-60","40-60","&lt;21","21- 40","21- 40","41-50","40-60","&gt;60","&lt;21","21- 40","21- 40","41-50","40-60","&gt;60","&gt;60","21- 40","41-50","41-50","41-50","41-50","41-50","40-60","&gt;60","&gt;60","41-50","40-60","40-60","&gt;60","&gt;60","&gt;60","&lt;21","21- 40","21- 40","41-50","40-60","&gt;60","&gt;60","&lt;21","21- 40","21- 40","41-50","40-60","&gt;60","21- 40","41-50","41-50","40-60","&gt;60","&gt;60","&gt;60","&gt;60","&lt;21","21- 40","40-60","&gt;60","&gt;60","41-50","41-50","40-60","&gt;60","&gt;60","41-50","40-60","&lt;21","21- 40","41-50","&lt;21","21- 40","21- 40","40-60","40-60","&gt;60","&lt;21","21- 40","41-50","41-50","&lt;21","&lt;21","21- 40","40-60","40-60","&gt;60","&gt;60","&gt;60","&lt;21","41-50","41-50","40-60","&gt;60","&gt;60","41-50","41-50","41-50","40-60","40-60","40-60","&gt;60","&gt;60","&lt;21","&lt;21","21- 40","41-50","40-60","&gt;60","&lt;21","&lt;21","41-50","41-50","40-60","41-50","40-60","41-50","40-60","40-60","40-60","&lt;21","&lt;21","&lt;21","&lt;21","21- 40","41-50","41-50","40-60","&gt;60","&lt;21","&lt;21","21- 40","41-50","40-60","40-60","&gt;60","&gt;60","&lt;21","&lt;21","21- 40","21- 40","21- 40","21- 40","21- 40","41-50","40-60","40-60","40-60","21- 40","21- 40","21- 40","41-50","40-60","40-60","&gt;60","&lt;21","21- 40","21- 40","21- 40","41-50","40-60","&lt;21","&lt;21","41-50","40-60","40-60","&gt;60","&gt;60","21- 40","41-50","41-50","41-50","41-50","40-60","40-60","21- 40","21- 40","41-50","40-60","40-60","&gt;60","&gt;60","40-60"],[187,27,149,11,101,40,19,50,3,6,9,30,26345,1768,1448,1741,22369,17,113,361,566,375,115,3729,57,12889,33,3251,39,259,102,365,14,451,44,10,1132,68,36,45,116,2,1,514,244,538,229,3,751,4043,459,54,1,18665,55,6,34,287,1850,8301,6612,1869,134461,65,23,29,4369,2120,7562,14907,8,1122,433,19687,2908,633,4679,12,2,281,106,124,156,702,77,1232,39,2342,1672,7,2,203,353,23,17,455,8,49,6,1,1,89,121,6,3,576,421,5225,1,8,3,2,6,16,4888,372,12818,1338,510,26427,12618,36,7,5135,437,4124,109,163,422,2018,3,7992,425,1635,83,93,1192,17,161,11,54,3,61,5,455,1,17,41,52,37,1,146,11,4,122,2,203,654,31,984,361,13,41,191,159,424,3842,2402,857,1544,8235,14270,463,17,25238,14746,239,140,4079,5071,304,14427,112,1,13,2,133,74,813,48,23,6,7,248,2,88,3,1,2,62,24,54,1,476,97,2,20,38,159,45,45,429,83,16,82,427,199,518,259,22,141,159,185,42,1797,10,14171,686,701,25,194,4609,483,12851,315,139,2,57,13671,14,6619,53,151,919,154,768,40,143,108,27,2476,831,122,1176,5,588,20,118,5,65,2,43,2,2,123,1,174,381,3,171,450,504,72,14,626,5387,3805,2504,25058,6418,50078,13,894,13,163,211,20909,19885,16,18,6001,578,15952,1150,1,4,116,209,2307,360,1,3356,126,180,12053,179,1,418,2,5,13,28,8,9,2,73,12,16,15,50,8,52,60,99,86,2142,1,35,287,801,301,13,599,438,702,166,28,2039,228,63,267,2335,20,2044,3571,21262,11583,2880,5762,12,2,313,189,16603,7,1198,4947,140,71,57,200,134,4,6,12233,194,550,39,190,39,8165,2,125,45,16,9,74,158,170,11,11,3,35,12,93,64,14,9,11,28,1536,704,445,402,23933,1431,2187,1058,1980,2074,478,1488,2,10,526,735,290,170,31700,5163,94,21910,31,4,235,1771,130,85,175,19,75,7,305,4712,736,38,49,27,69,40,22,136,19,20,28,16,2,64,39,10,3,398,4,205,15,1,1,18,28,15,27,120,5276,49,278,1189,256,631,11,1,3,2,14,93,1835,412,1125,49,508,280,299,357,3,5733,3643,23834,2,17352,41,499,897,4344,18774,90,107,9542,1,2,18,38,128,1,3,11,5,27,1,1,20,15,108,310,1,28,85,105,492,3411,486,63,6098,329,3030,9991,1539,12459,8493,26183,353,1,333,7883,11997,357,19355,23,1,559,11,1642,23010,45,9,68,9334,19068,23,1888,97,12,2,1,2402,58,3,9,8,5,4,2,1,1,1,6,470,2,933,1082,173,39,422,24,12517,2959,1779,6,79,19294,2784,279,2401,416,1035,7,259,27,3160,194,2305,184,25309,1555,265,194,1310,6620,11710,3,1,34,67,2716,34,1,5,557,131,197,15,8,19,8,128,389,10,22,8,9,95,669,106,22,2051,3,1,2023,1731,1200,169,20461,2282,13,65,367,1138,5795,753,24021,1741,645,15139,10321,267,1735,30,652,749,5205,238,5,83,171,2990,79,299,4,1,1967,23,13,183,562,20,12,15,29,191,8,50,13,60,125,5,5,45,4,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>segmento<\/th>\n      <th>tipo<\/th>\n      <th>valor_cliente<\/th>\n      <th>edad_cat<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[3,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Tenemos 667 filas con la info de 1.456239^{6} observaciones</p>
<p>Agregamos y bajamos el test</p>
<pre class="r"><code>test_local &lt;- test |&gt;
  group_by(segmento,
           tipo,
           valor_cliente,
           edad_cat) |&gt;
  count()  |&gt;
  collect() |&gt; 
  # ponemos las variables categóricas a tipo factor
  mutate(across(where(is.character), as_factor))


DT::datatable(test_local)</code></pre>
<div id="htmlwidget-2" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427","428","429","430","431","432","433","434","435","436","437","438","439","440","441","442","443","444","445","446","447","448","449","450","451","452","453","454","455","456","457","458","459","460","461","462","463","464","465","466","467","468","469","470","471","472","473","474","475","476","477","478","479","480","481","482","483","484","485","486","487","488","489","490","491","492","493","494","495","496","497","498","499","500","501","502","503","504","505","506","507","508","509","510","511","512","513","514","515","516","517","518","519","520","521","522","523","524","525","526","527","528","529","530","531","532","533","534","535","536","537","538","539","540","541","542","543","544","545","546","547","548","549","550","551","552","553","554","555","556","557","558","559","560","561","562","563","564","565","566","567","568","569","570","571","572","573","574","575","576","577","578","579","580","581","582","583","584","585","586","587","588","589","590","591","592","593","594","595","596","597","598","599","600","601","602","603","604","605","606","607","608","609","610","611","612","613","614","615","616","617","618","619","620","621","622","623","624","625","626","627","628","629","630","631","632","633","634","635","636","637","638","639","640","641","642","643","644","645","646","647","648","649","650","651","652","653","654","655"],["Rec","Neut","Rec","Best","Neut","Best","Neut","Neut","Neut","Best","Rec","Rec","No_way","No_way","Best","No_way","Rec","No_way","Best","Rec","No_way","Rec","Best","Best","Best","Neut","Neut","Best","Best","Best","No_way","Neut","No_way","Best","Best","No_way","Rec","Best","No_way","No_way","No_way","Rec","Best","No_way","No_way","Best","Neut","Rec","Rec","Best","No_way","Best","Rec","No_way","Neut","Neut","Rec","Neut","Neut","Neut","Neut","No_way","Rec","Best","Best","Best","Best","Best","Neut","Neut","No_way","Best","Neut","Rec","Best","Neut","No_way","Best","No_way","Rec","Neut","Best","Neut","Best","No_way","Rec","No_way","Neut","Rec","Rec","No_way","Best","Neut","Best","Neut","Best","Neut","Best","Neut","No_way","Neut","Rec","No_way","Rec","Best","Best","No_way","Rec","Best","Neut","No_way","No_way","Best","Rec","Neut","Rec","Best","No_way","Rec","Neut","No_way","Neut","Rec","Neut","Best","Neut","Best","Neut","Best","Rec","Best","No_way","Rec","Neut","No_way","Rec","Neut","Rec","Neut","Best","No_way","Rec","Best","Neut","No_way","Best","Neut","Best","Best","Neut","No_way","Neut","Neut","Best","Rec","Neut","No_way","Rec","Best","Rec","Rec","Best","Rec","No_way","Neut","No_way","Best","No_way","Rec","Best","Rec","Neut","Rec","Rec","Best","Best","No_way","No_way","Rec","Rec","Best","Neut","Neut","No_way","No_way","Rec","Neut","Neut","Rec","Rec","Rec","Best","Best","Best","Rec","Rec","No_way","Neut","No_way","No_way","No_way","Neut","Rec","Neut","No_way","Rec","No_way","No_way","No_way","Neut","Rec","No_way","Best","Best","Rec","Rec","No_way","Neut","Neut","Rec","Rec","Neut","Neut","Best","Neut","Neut","Best","No_way","No_way","No_way","Rec","Rec","Best","No_way","Best","Rec","Rec","No_way","Best","Neut","Neut","Best","Neut","Rec","Neut","No_way","No_way","Neut","Rec","Neut","Neut","Rec","No_way","Rec","Best","Rec","Best","Rec","No_way","Rec","No_way","Neut","Best","Rec","No_way","No_way","Best","No_way","Rec","Rec","Best","Rec","Rec","Best","Best","Neut","No_way","No_way","Neut","No_way","Best","Neut","Best","Neut","No_way","No_way","No_way","Best","Best","No_way","Rec","No_way","No_way","Rec","No_way","Best","No_way","No_way","Best","Neut","No_way","Rec","No_way","Rec","Rec","Rec","Neut","Neut","Neut","Rec","Neut","Rec","No_way","Best","No_way","No_way","Best","Best","No_way","No_way","Best","Best","No_way","Best","Best","Neut","Best","Neut","Neut","Rec","Neut","Rec","No_way","Best","Neut","Best","Neut","Neut","Rec","Rec","No_way","Best","Neut","No_way","Best","Neut","Neut","Rec","Rec","Rec","No_way","Best","Neut","Rec","Best","Neut","Rec","No_way","Neut","No_way","Neut","No_way","No_way","Rec","No_way","Rec","Rec","Neut","Best","No_way","Best","No_way","Rec","Neut","Rec","No_way","Best","Neut","No_way","No_way","Best","Neut","Best","Neut","Neut","No_way","Neut","No_way","No_way","No_way","Rec","Rec","No_way","No_way","No_way","Best","Best","Best","Neut","Neut","No_way","Rec","Best","Neut","No_way","Best","No_way","Neut","No_way","Neut","Neut","No_way","Rec","No_way","Rec","Rec","Rec","Best","Rec","No_way","Rec","Rec","Best","Neut","Best","No_way","Neut","No_way","Neut","Best","No_way","Best","Best","No_way","No_way","Neut","Rec","Neut","No_way","Best","No_way","Rec","Neut","Neut","Best","Neut","Neut","No_way","Neut","No_way","No_way","Best","Neut","Rec","Neut","Rec","Neut","Best","Best","Best","Neut","Rec","Rec","Best","Neut","Rec","Rec","Best","Best","Neut","Best","Neut","Neut","Best","No_way","Neut","Best","Neut","Neut","Best","Neut","Neut","Best","No_way","Neut","No_way","Best","No_way","Neut","No_way","Neut","Best","Best","Neut","Rec","Rec","Rec","Rec","Best","Best","Neut","No_way","Rec","No_way","Best","Best","Neut","No_way","No_way","No_way","No_way","Rec","No_way","No_way","No_way","No_way","Neut","Neut","Best","Best","Rec","Neut","Neut","Best","Rec","No_way","Rec","Neut","Best","Best","Neut","Rec","No_way","Rec","Neut","Neut","Neut","No_way","Best","Neut","Rec","Neut","Neut","No_way","No_way","Rec","Rec","Neut","Neut","Best","Rec","No_way","Neut","Best","Neut","Best","Rec","Neut","Neut","Best","Rec","Neut","Neut","Rec","Best","Neut","Rec","Neut","Neut","No_way","Neut","Neut","No_way","Best","Neut","Neut","No_way","Rec","Neut","No_way","Rec","Best","No_way","Best","Neut","Best","No_way","No_way","Neut","Best","No_way","Best","Best","No_way","Best","Best","No_way","Rec","Best","No_way","Best","No_way","Rec","No_way","No_way","No_way","Best","Neut","No_way","No_way","No_way","No_way","Best","Best","Best","No_way","No_way","Rec","Neut","Neut","Rec","Best","Best","Rec","No_way","Best","No_way","Rec","Neut","Neut","No_way","Best","Best","No_way","Best","Best","No_way","Best","Rec","No_way","No_way","Best","No_way","Best","Best","Neut","Best","No_way","Neut","No_way","Rec","Neut","Neut","Best","Neut"],["C","SM","B","B","SM","SM","SF","B","SF","SF","SM","SM","C","SM","SM","C","C","SM","B","SF","B","SF","SF","C","SF","C","C","C","B","SM","B","SM","SM","C","B","SF","C","SF","SM","SF","C","C","B","SM","SM","C","C","C","C","SM","SM","SM","SF","SM","SF","C","C","B","SM","SM","SF","SF","B","B","C","SM","C","SM","SM","C","C","SM","B","C","C","B","SM","C","SF","SF","SF","SM","SM","SF","C","B","C","C","SF","SM","C","SM","C","SM","C","SM","SM","SF","SM","B","SM","C","B","B","SF","C","SM","C","B","SF","B","C","C","C","SF","SF","SF","C","C","C","SF","SM","SF","SM","SF","SF","SM","SM","SM","C","SM","SM","B","SF","SM","SM","B","SM","SF","C","SF","SF","C","SM","SM","SF","SM","B","C","SF","C","SF","C","C","B","C","C","B","B","SF","SF","B","SF","SF","C","B","SM","C","C","SF","C","C","C","B","SF","C","C","SF","C","SF","C","SM","SF","B","SM","SF","SM","SF","SM","B","SF","C","C","B","B","SF","SM","SM","C","C","C","C","SF","B","SF","C","SM","SF","C","B","B","B","C","SF","C","B","SM","SF","SF","SF","B","B","SM","SF","B","SM","B","SM","B","C","SF","SM","B","SF","B","C","SM","C","B","B","SM","SM","SM","SF","B","SM","C","C","C","SM","C","C","B","B","C","SF","C","B","SM","B","C","SM","SM","B","SF","SM","B","B","C","C","SM","SM","SM","SF","SM","C","SF","SM","SM","SM","SF","B","B","SF","SM","B","SM","C","C","SF","C","SF","C","SF","B","C","SF","SF","C","B","SF","C","B","C","B","B","SF","B","SF","SF","C","C","B","SM","SF","SF","SM","SF","B","C","B","B","SF","B","SF","SM","SM","SF","SM","C","SM","SM","SF","C","B","B","B","C","SF","C","SF","SM","C","C","C","SM","SF","B","C","C","SM","C","SF","B","SF","B","SF","C","SF","B","C","SF","SM","B","SF","B","C","SM","SM","B","SF","SM","C","SM","B","SF","SF","SF","B","C","C","SF","SF","C","SF","SF","C","C","B","SM","C","SF","B","SF","SF","B","SM","SM","B","B","SF","B","SF","C","SM","B","C","C","SM","SM","B","B","B","B","SM","B","C","SM","C","SM","B","SF","SF","SF","SM","B","SM","B","B","SM","SF","B","SF","C","SF","C","SF","C","B","C","SF","SF","B","B","SM","SM","B","SM","B","C","SF","SM","C","B","B","SM","SM","C","SF","C","C","SF","B","B","SF","B","SF","C","C","C","B","B","C","B","B","SM","C","C","SF","SM","C","SF","SM","SM","SF","B","B","SF","C","SM","B","SF","SM","C","B","SF","SM","B","B","SF","C","B","B","SF","B","SF","SM","B","C","SF","SM","B","B","B","C","C","B","C","SF","SM","SM","SM","C","B","SM","B","C","C","B","C","B","SM","C","SM","C","SM","B","B","B","SF","SF","SM","C","B","SM","SF","SF","C","SM","SF","SF","B","B","C","SM","SM","C","SM","C","C","B","B","SF","SF","SF","SF","SM","SM","SF","B","B","C","SM","SM","B","SM","C","C","B","SM","SF","SF","C","SF","C","C","SM","C","SF","SF","B","B","C","SM","C","SF","C","SF","C","B","B","SF","SM","B","C","C","C","SF","B","C","SF","SM","B","SF","SM","B","SM","SF","B","C","C","SF","SM","SM","SF","SM","SM","B","SM","SF","C","B","SF","SF","SF","SM","C","B","SM","SF","SM","SF","C","B","SF","B","B","SF","B","C","C","B","SF","C","B"],[0,0,0,0,0,0,1,1,2,2,2,3,2,2,2,2,2,3,4,4,4,4,5,5,5,5,6,6,6,6,6,6,7,7,7,7,7,7,7,8,8,8,8,9,0,0,0,0,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,4,4,4,4,4,4,4,5,5,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,8,8,8,0,0,0,0,1,1,1,1,1,2,2,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,6,6,6,7,7,7,7,8,8,8,8,0,0,0,0,0,0,1,1,1,1,1,1,2,2,2,2,2,2,2,2,3,3,3,4,4,4,4,4,5,5,5,5,5,6,6,6,6,6,6,7,7,7,7,7,7,8,8,8,8,8,8,8,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,3,2,2,2,2,2,2,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,9,9,0,0,0,0,0,1,1,1,2,3,3,2,2,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,6,6,6,6,6,6,7,7,7,7,7,7,7,8,8,8,8,8,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,3,2,2,2,2,2,2,2,3,3,3,3,3,3,3,4,4,4,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,7,7,7,7,8,8,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,5,5,5,5,5,6,6,6,6,6,6,7,7,7,8,8,8,8,9,0,0,0,0,0,0,1,4,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,6,6,6,6,6,6,6,6,7,7,7,7,8,8,8,8,8,9,0,0,0,0,1,1,1,1,1,1,3,2,2,2,2,3,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,5,5,6,6,6,6,6,6,7,7,7,7,8,8,0,0,0,0,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,5,5,5,5,5,5,6,6,6,6,6,6,6,7,7,7,7,7,7,7,8,8,8,8,8,8,8],["21- 40","41-50","41-50","41-50","40-60","&gt;60","41-50","&gt;60","&lt;21","&lt;21","21- 40","41-50","&lt;21","21- 40","40-60","40-60","&gt;60","41-50","41-50","41-50","40-60","&gt;60","21- 40","40-60","&gt;60","&gt;60","&lt;21","21- 40","41-50","41-50","40-60","&gt;60","&lt;21","21- 40","21- 40","41-50","40-60","40-60","&gt;60","21- 40","40-60","&gt;60","&gt;60","21- 40","21- 40","41-50","41-50","41-50","&lt;21","21- 40","21- 40","41-50","41-50","&gt;60","&gt;60","&lt;21","21- 40","21- 40","41-50","40-60","&gt;60","&gt;60","&gt;60","&lt;21","&lt;21","&lt;21","41-50","40-60","40-60","&gt;60","&lt;21","41-50","41-50","41-50","&gt;60","&gt;60","&gt;60","&lt;21","21- 40","21- 40","40-60","&gt;60","&gt;60","21- 40","21- 40","40-60","&gt;60","21- 40","21- 40","40-60","&gt;60","21- 40","21- 40","41-50","41-50","40-60","40-60","&gt;60","&lt;21","&lt;21","&gt;60","&gt;60","&lt;21","&lt;21","21- 40","40-60","40-60","&lt;21","&lt;21","&lt;21","&lt;21","&lt;21","21- 40","21- 40","21- 40","40-60","&gt;60","&gt;60","&gt;60","&lt;21","&lt;21","21- 40","21- 40","41-50","40-60","40-60","&gt;60","&gt;60","&lt;21","21- 40","41-50","40-60","40-60","&gt;60","&gt;60","&gt;60","21- 40","41-50","&gt;60","&lt;21","21- 40","41-50","40-60","21- 40","21- 40","21- 40","41-50","21- 40","21- 40","21- 40","41-50","40-60","&gt;60","21- 40","21- 40","41-50","41-50","40-60","&gt;60","&lt;21","40-60","21- 40","21- 40","41-50","40-60","40-60","&gt;60","21- 40","41-50","40-60","&lt;21","21- 40","21- 40","41-50","&gt;60","21- 40","41-50","41-50","40-60","40-60","&lt;21","&lt;21","21- 40","21- 40","40-60","40-60","&lt;21","41-50","41-50","40-60","40-60","&gt;60","21- 40","21- 40","21- 40","21- 40","40-60","&gt;60","&gt;60","&lt;21","21- 40","21- 40","21- 40","41-50","40-60","40-60","&lt;21","&lt;21","21- 40","41-50","41-50","40-60","&gt;60","&gt;60","&gt;60","&lt;21","&lt;21","21- 40","41-50","41-50","40-60","&gt;60","21- 40","41-50","41-50","&lt;21","21- 40","21- 40","41-50","40-60","40-60","40-60","&gt;60","&lt;21","41-50","41-50","41-50","40-60","21- 40","41-50","41-50","40-60","40-60","&gt;60","21- 40","21- 40","21- 40","41-50","41-50","40-60","&gt;60","&gt;60","&gt;60","&gt;60","41-50","41-50","40-60","40-60","&gt;60","&gt;60","21- 40","21- 40","21- 40","40-60","&gt;60","&gt;60","&gt;60","21- 40","21- 40","41-50","&lt;21","21- 40","40-60","21- 40","21- 40","21- 40","21- 40","40-60","&gt;60","&gt;60","&lt;21","21- 40","40-60","40-60","40-60","&gt;60","&lt;21","&lt;21","41-50","40-60","40-60","&gt;60","&lt;21","41-50","40-60","&gt;60","&gt;60","&lt;21","40-60","40-60","40-60","40-60","&gt;60","21- 40","21- 40","41-50","40-60","&gt;60","&gt;60","&gt;60","&lt;21","21- 40","40-60","&gt;60","&gt;60","21- 40","40-60","40-60","&gt;60","&gt;60","&lt;21","21- 40","21- 40","41-50","41-50","41-50","40-60","40-60","40-60","40-60","&gt;60","&gt;60","&lt;21","21- 40","41-50","40-60","40-60","&gt;60","&gt;60","&lt;21","21- 40","41-50","41-50","41-50","&gt;60","&gt;60","21- 40","40-60","&gt;60","&lt;21","21- 40","41-50","41-50","41-50","40-60","&gt;60","&gt;60","&lt;21","&lt;21","&lt;21","21- 40","21- 40","21- 40","21- 40","41-50","&gt;60","&gt;60","21- 40","41-50","40-60","&gt;60","41-50","40-60","21- 40","21- 40","41-50","41-50","41-50","40-60","40-60","&gt;60","&gt;60","&gt;60","&lt;21","21- 40","41-50","40-60","&gt;60","21- 40","41-50","40-60","21- 40","41-50","41-50","40-60","&gt;60","&gt;60","&lt;21","&lt;21","21- 40","21- 40","21- 40","41-50","41-50","41-50","40-60","&gt;60","&lt;21","&lt;21","21- 40","21- 40","21- 40","21- 40","41-50","40-60","&gt;60","&lt;21","21- 40","21- 40","41-50","41-50","41-50","40-60","40-60","21- 40","21- 40","41-50","41-50","40-60","&gt;60","&gt;60","&gt;60","41-50","41-50","41-50","40-60","40-60","&gt;60","&gt;60","&lt;21","&lt;21","41-50","40-60","&gt;60","&lt;21","&lt;21","21- 40","41-50","40-60","40-60","40-60","&gt;60","&gt;60","&gt;60","&lt;21","41-50","&lt;21","41-50","40-60","&gt;60","&lt;21","&lt;21","21- 40","41-50","41-50","41-50","&lt;21","21- 40","40-60","40-60","&lt;21","&lt;21","21- 40","40-60","&gt;60","21- 40","41-50","41-50","41-50","&gt;60","&gt;60","21- 40","40-60","40-60","21- 40","21- 40","41-50","40-60","40-60","&lt;21","21- 40","21- 40","41-50","40-60","&gt;60","&gt;60","&gt;60","21- 40","41-50","41-50","41-50","41-50","41-50","40-60","&gt;60","&gt;60","41-50","40-60","40-60","&gt;60","&gt;60","&gt;60","&lt;21","21- 40","21- 40","41-50","40-60","&gt;60","&lt;21","21- 40","21- 40","41-50","40-60","&gt;60","21- 40","41-50","41-50","40-60","&gt;60","&gt;60","&gt;60","&gt;60","&lt;21","21- 40","40-60","&gt;60","41-50","41-50","40-60","&gt;60","&gt;60","41-50","&lt;21","21- 40","41-50","&gt;60","&lt;21","21- 40","21- 40","40-60","40-60","&gt;60","&lt;21","&lt;21","21- 40","41-50","41-50","&lt;21","21- 40","40-60","40-60","&gt;60","&gt;60","&gt;60","&lt;21","41-50","41-50","40-60","&gt;60","&gt;60","41-50","41-50","41-50","40-60","40-60","40-60","&gt;60","&gt;60","&lt;21","&lt;21","21- 40","41-50","40-60","&gt;60","&lt;21","41-50","41-50","40-60","41-50","40-60","41-50","40-60","40-60","40-60","&lt;21","&lt;21","&lt;21","21- 40","41-50","41-50","40-60","&gt;60","40-60","&lt;21","21- 40","41-50","40-60","40-60","&gt;60","&gt;60","&lt;21","&lt;21","21- 40","21- 40","21- 40","21- 40","21- 40","41-50","40-60","40-60","40-60","21- 40","21- 40","21- 40","41-50","40-60","40-60","&gt;60","&lt;21","21- 40","21- 40","21- 40","41-50","40-60","&lt;21","&lt;21","41-50","40-60","40-60","&gt;60","&gt;60","21- 40","41-50","41-50","41-50","41-50","40-60","40-60","21- 40","21- 40","41-50","40-60","40-60","&gt;60","&gt;60"],[127,105,8,23,59,31,18,56,2,12,2,14,20,17779,1189,960,1192,14994,98,226,417,234,68,2456,30,8473,25,2188,27,171,87,259,1,313,9,33,752,5,68,25,32,77,1,1,356,183,409,188,5,505,2749,324,26,12233,35,21,1213,179,5579,4572,1185,89672,53,2,13,15,2897,1424,4898,9896,9,732,282,13150,1842,399,3120,10,188,90,88,108,478,51,821,25,1562,1175,4,1,139,17,205,10,301,3,25,3,2,1,52,70,4,2,364,298,3612,10,1,3,4,9,3151,8456,235,835,324,17800,8198,27,8,3398,264,2734,81,136,317,1313,3,5412,284,1042,61,59,840,8,99,7,29,2,35,6,273,27,37,6,29,7,102,2,73,2,121,427,21,699,248,7,20,1,129,128,288,2450,1622,541,999,5356,9517,326,5,16946,10032,136,107,2626,3373,178,9787,75,12,4,84,57,504,27,3,14,2,3,5,168,65,4,2,6,34,11,32,1,66,295,1,17,22,120,30,20,276,56,10,58,256,131,302,5,82,102,104,183,16,1192,9462,506,474,16,147,2954,295,8439,199,15,86,2,48,9257,14,4317,26,72,563,137,509,31,18,71,100,1698,550,59,759,435,14,3,68,2,49,1,20,1,1,1,71,5,122,275,2,104,266,321,56,18,7,426,3590,2585,1644,16589,4434,33748,8,568,111,158,14012,13275,14,8,3921,340,10484,791,3,67,171,1495,210,3,2319,96,116,8072,121,295,5,8,15,15,7,5,1,62,3,4,14,33,33,4,41,80,2,58,1411,32,206,528,191,12,406,293,447,7,24,1362,158,50,192,1496,118,11,1418,2369,14177,7760,1956,3942,177,108,10926,9,790,3327,93,51,30,149,87,4,1,1,8023,132,388,31,140,27,5451,84,39,11,5,49,111,116,3,26,10,2,10,63,33,9,4,12,32,1012,535,313,243,16138,947,1469,718,1418,1319,307,978,3,3,360,426,228,131,21152,3380,59,14704,24,7,1222,150,101,66,117,10,60,6,205,3113,479,21,37,22,51,31,6,110,8,14,13,26,2,11,41,13,246,1,136,7,1,1,2,9,9,14,20,62,3470,31,189,757,186,447,8,2,1,57,1162,262,758,31,6,385,159,174,244,4,3768,2470,16159,1,2,11660,26,312,597,2818,12513,65,80,6496,11,25,80,4,3,2,17,1,1,9,11,74,225,2,20,16,65,64,255,2289,334,42,4003,215,2028,6746,1045,8291,5653,17456,254,4,227,5350,8071,231,12869,3,361,11,1026,15268,34,5,72,6282,12798,15,1262,70,7,1,1,1580,28,8,8,4,3,1,1,1,11,352,1,1,668,733,107,17,269,5,14,8285,2002,1190,42,13034,1788,185,1576,273,711,2,199,28,2095,131,1518,126,16928,957,193,144,909,4458,7900,1,5,29,30,1807,21,5,383,81,149,6,3,6,3,82,255,5,5,6,67,446,76,11,1391,1,4,1392,1181,790,138,13734,1485,16,52,269,725,3939,545,15817,1166,445,9962,6856,186,1199,12,440,502,3562,162,2,109,2056,69,40,199,1,4,1293,16,11,118,394,14,140,11,4,17,6,16,5,30,80,10,1,36,2]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>segmento<\/th>\n      <th>tipo<\/th>\n      <th>valor_cliente<\/th>\n      <th>edad_cat<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[3,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Tenemos 655 con la info de 9.72147^{5} observaciones</p>
<pre class="r"><code># desconectamos spark
spark_disconnect(sc)</code></pre>
<div id="glmer" class="section level2">
<h2>glmer</h2>
<p>Hacemos un par de modelos mixtos como en el post anterior, pero en los datos de train</p>
<pre class="r"><code>library(lme4)

modA &lt;- glmer(segmento == &quot;Best&quot; ~ (1 | edad_cat) + (1 | valor_cliente) + (1 | tipo),
              data = train_local, family= binomial, weights= train_local$n)  

modB &lt;-  glmer(segmento == &quot;No_way&quot; ~(1 | edad_cat) + (1  |valor_cliente) + (1 | tipo),
               data = train_local, family= binomial, weights= train_local$n)  </code></pre>
<p>Podemos ver el modelo A por ejemplo</p>
<pre class="r"><code>summary(modA)</code></pre>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: binomial  ( logit )
## Formula: segmento == &quot;Best&quot; ~ (1 | edad_cat) + (1 | valor_cliente) + (1 |  
##     tipo)
##    Data: train_local
## Weights: train_local$n
## 
##       AIC       BIC    logLik  deviance  df.resid 
##  794795.3  794813.3 -397393.6  794787.3       663 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -71.799  -6.459  -2.006   1.667 281.127 
## 
## Random effects:
##  Groups        Name        Variance Std.Dev.
##  valor_cliente (Intercept) 0.06432  0.2536  
##  edad_cat      (Intercept) 0.39504  0.6285  
##  tipo          (Intercept) 0.01669  0.1292  
## Number of obs: 667, groups:  valor_cliente, 10; edad_cat, 5; tipo, 4
## 
## Fixed effects:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -2.0928     0.3023  -6.923 4.41e-12 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>sjPlot::plot_model(modA, type = &quot;re&quot;)</code></pre>
<pre><code>## [[1]]</code></pre>
<p><img src="/post/2021-05-21-big-data-pobres-ii-auc_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="/post/2021-05-21-big-data-pobres-ii-auc_files/figure-html/unnamed-chunk-10-2.png" width="672" /></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="/post/2021-05-21-big-data-pobres-ii-auc_files/figure-html/unnamed-chunk-10-3.png" width="672" /></p>
<div id="predicción-del-glmer" class="section level3">
<h3>Predicción del glmer</h3>
<p>Ahora hacemos predicción sobre el conjunto de test, que recordemos también está en formato de datos agregados.</p>
<pre class="r"><code>test_local$Apredict  &lt;- predict(modA, newdata = test_local,
                    allow.new.levels= TRUE,
                    type= &quot;response&quot;)

test_local$Bpredict &lt;-  predict(modB, newdata = test_local,
                    allow.new.levels= TRUE,
                    type= &quot;response&quot;)</code></pre>
<pre class="r"><code>test_local |&gt; 
  select(segmento, n, Apredict, Bpredict) |&gt; 
  DT::datatable()</code></pre>
<div id="htmlwidget-3" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-3">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427","428","429","430","431","432","433","434","435","436","437","438","439","440","441","442","443","444","445","446","447","448","449","450","451","452","453","454","455","456","457","458","459","460","461","462","463","464","465","466","467","468","469","470","471","472","473","474","475","476","477","478","479","480","481","482","483","484","485","486","487","488","489","490","491","492","493","494","495","496","497","498","499","500","501","502","503","504","505","506","507","508","509","510","511","512","513","514","515","516","517","518","519","520","521","522","523","524","525","526","527","528","529","530","531","532","533","534","535","536","537","538","539","540","541","542","543","544","545","546","547","548","549","550","551","552","553","554","555","556","557","558","559","560","561","562","563","564","565","566","567","568","569","570","571","572","573","574","575","576","577","578","579","580","581","582","583","584","585","586","587","588","589","590","591","592","593","594","595","596","597","598","599","600","601","602","603","604","605","606","607","608","609","610","611","612","613","614","615","616","617","618","619","620","621","622","623","624","625","626","627","628","629","630","631","632","633","634","635","636","637","638","639","640","641","642","643","644","645","646","647","648","649","650","651","652","653","654","655"],["Rec","Neut","Rec","Best","Neut","Best","Neut","Neut","Neut","Best","Rec","Rec","No_way","No_way","Best","No_way","Rec","No_way","Best","Rec","No_way","Rec","Best","Best","Best","Neut","Neut","Best","Best","Best","No_way","Neut","No_way","Best","Best","No_way","Rec","Best","No_way","No_way","No_way","Rec","Best","No_way","No_way","Best","Neut","Rec","Rec","Best","No_way","Best","Rec","No_way","Neut","Neut","Rec","Neut","Neut","Neut","Neut","No_way","Rec","Best","Best","Best","Best","Best","Neut","Neut","No_way","Best","Neut","Rec","Best","Neut","No_way","Best","No_way","Rec","Neut","Best","Neut","Best","No_way","Rec","No_way","Neut","Rec","Rec","No_way","Best","Neut","Best","Neut","Best","Neut","Best","Neut","No_way","Neut","Rec","No_way","Rec","Best","Best","No_way","Rec","Best","Neut","No_way","No_way","Best","Rec","Neut","Rec","Best","No_way","Rec","Neut","No_way","Neut","Rec","Neut","Best","Neut","Best","Neut","Best","Rec","Best","No_way","Rec","Neut","No_way","Rec","Neut","Rec","Neut","Best","No_way","Rec","Best","Neut","No_way","Best","Neut","Best","Best","Neut","No_way","Neut","Neut","Best","Rec","Neut","No_way","Rec","Best","Rec","Rec","Best","Rec","No_way","Neut","No_way","Best","No_way","Rec","Best","Rec","Neut","Rec","Rec","Best","Best","No_way","No_way","Rec","Rec","Best","Neut","Neut","No_way","No_way","Rec","Neut","Neut","Rec","Rec","Rec","Best","Best","Best","Rec","Rec","No_way","Neut","No_way","No_way","No_way","Neut","Rec","Neut","No_way","Rec","No_way","No_way","No_way","Neut","Rec","No_way","Best","Best","Rec","Rec","No_way","Neut","Neut","Rec","Rec","Neut","Neut","Best","Neut","Neut","Best","No_way","No_way","No_way","Rec","Rec","Best","No_way","Best","Rec","Rec","No_way","Best","Neut","Neut","Best","Neut","Rec","Neut","No_way","No_way","Neut","Rec","Neut","Neut","Rec","No_way","Rec","Best","Rec","Best","Rec","No_way","Rec","No_way","Neut","Best","Rec","No_way","No_way","Best","No_way","Rec","Rec","Best","Rec","Rec","Best","Best","Neut","No_way","No_way","Neut","No_way","Best","Neut","Best","Neut","No_way","No_way","No_way","Best","Best","No_way","Rec","No_way","No_way","Rec","No_way","Best","No_way","No_way","Best","Neut","No_way","Rec","No_way","Rec","Rec","Rec","Neut","Neut","Neut","Rec","Neut","Rec","No_way","Best","No_way","No_way","Best","Best","No_way","No_way","Best","Best","No_way","Best","Best","Neut","Best","Neut","Neut","Rec","Neut","Rec","No_way","Best","Neut","Best","Neut","Neut","Rec","Rec","No_way","Best","Neut","No_way","Best","Neut","Neut","Rec","Rec","Rec","No_way","Best","Neut","Rec","Best","Neut","Rec","No_way","Neut","No_way","Neut","No_way","No_way","Rec","No_way","Rec","Rec","Neut","Best","No_way","Best","No_way","Rec","Neut","Rec","No_way","Best","Neut","No_way","No_way","Best","Neut","Best","Neut","Neut","No_way","Neut","No_way","No_way","No_way","Rec","Rec","No_way","No_way","No_way","Best","Best","Best","Neut","Neut","No_way","Rec","Best","Neut","No_way","Best","No_way","Neut","No_way","Neut","Neut","No_way","Rec","No_way","Rec","Rec","Rec","Best","Rec","No_way","Rec","Rec","Best","Neut","Best","No_way","Neut","No_way","Neut","Best","No_way","Best","Best","No_way","No_way","Neut","Rec","Neut","No_way","Best","No_way","Rec","Neut","Neut","Best","Neut","Neut","No_way","Neut","No_way","No_way","Best","Neut","Rec","Neut","Rec","Neut","Best","Best","Best","Neut","Rec","Rec","Best","Neut","Rec","Rec","Best","Best","Neut","Best","Neut","Neut","Best","No_way","Neut","Best","Neut","Neut","Best","Neut","Neut","Best","No_way","Neut","No_way","Best","No_way","Neut","No_way","Neut","Best","Best","Neut","Rec","Rec","Rec","Rec","Best","Best","Neut","No_way","Rec","No_way","Best","Best","Neut","No_way","No_way","No_way","No_way","Rec","No_way","No_way","No_way","No_way","Neut","Neut","Best","Best","Rec","Neut","Neut","Best","Rec","No_way","Rec","Neut","Best","Best","Neut","Rec","No_way","Rec","Neut","Neut","Neut","No_way","Best","Neut","Rec","Neut","Neut","No_way","No_way","Rec","Rec","Neut","Neut","Best","Rec","No_way","Neut","Best","Neut","Best","Rec","Neut","Neut","Best","Rec","Neut","Neut","Rec","Best","Neut","Rec","Neut","Neut","No_way","Neut","Neut","No_way","Best","Neut","Neut","No_way","Rec","Neut","No_way","Rec","Best","No_way","Best","Neut","Best","No_way","No_way","Neut","Best","No_way","Best","Best","No_way","Best","Best","No_way","Rec","Best","No_way","Best","No_way","Rec","No_way","No_way","No_way","Best","Neut","No_way","No_way","No_way","No_way","Best","Best","Best","No_way","No_way","Rec","Neut","Neut","Rec","Best","Best","Rec","No_way","Best","No_way","Rec","Neut","Neut","No_way","Best","Best","No_way","Best","Best","No_way","Best","Rec","No_way","No_way","Best","No_way","Best","Best","Neut","Best","No_way","Neut","No_way","Rec","Neut","Neut","Best","Neut"],[127,105,8,23,59,31,18,56,2,12,2,14,20,17779,1189,960,1192,14994,98,226,417,234,68,2456,30,8473,25,2188,27,171,87,259,1,313,9,33,752,5,68,25,32,77,1,1,356,183,409,188,5,505,2749,324,26,12233,35,21,1213,179,5579,4572,1185,89672,53,2,13,15,2897,1424,4898,9896,9,732,282,13150,1842,399,3120,10,188,90,88,108,478,51,821,25,1562,1175,4,1,139,17,205,10,301,3,25,3,2,1,52,70,4,2,364,298,3612,10,1,3,4,9,3151,8456,235,835,324,17800,8198,27,8,3398,264,2734,81,136,317,1313,3,5412,284,1042,61,59,840,8,99,7,29,2,35,6,273,27,37,6,29,7,102,2,73,2,121,427,21,699,248,7,20,1,129,128,288,2450,1622,541,999,5356,9517,326,5,16946,10032,136,107,2626,3373,178,9787,75,12,4,84,57,504,27,3,14,2,3,5,168,65,4,2,6,34,11,32,1,66,295,1,17,22,120,30,20,276,56,10,58,256,131,302,5,82,102,104,183,16,1192,9462,506,474,16,147,2954,295,8439,199,15,86,2,48,9257,14,4317,26,72,563,137,509,31,18,71,100,1698,550,59,759,435,14,3,68,2,49,1,20,1,1,1,71,5,122,275,2,104,266,321,56,18,7,426,3590,2585,1644,16589,4434,33748,8,568,111,158,14012,13275,14,8,3921,340,10484,791,3,67,171,1495,210,3,2319,96,116,8072,121,295,5,8,15,15,7,5,1,62,3,4,14,33,33,4,41,80,2,58,1411,32,206,528,191,12,406,293,447,7,24,1362,158,50,192,1496,118,11,1418,2369,14177,7760,1956,3942,177,108,10926,9,790,3327,93,51,30,149,87,4,1,1,8023,132,388,31,140,27,5451,84,39,11,5,49,111,116,3,26,10,2,10,63,33,9,4,12,32,1012,535,313,243,16138,947,1469,718,1418,1319,307,978,3,3,360,426,228,131,21152,3380,59,14704,24,7,1222,150,101,66,117,10,60,6,205,3113,479,21,37,22,51,31,6,110,8,14,13,26,2,11,41,13,246,1,136,7,1,1,2,9,9,14,20,62,3470,31,189,757,186,447,8,2,1,57,1162,262,758,31,6,385,159,174,244,4,3768,2470,16159,1,2,11660,26,312,597,2818,12513,65,80,6496,11,25,80,4,3,2,17,1,1,9,11,74,225,2,20,16,65,64,255,2289,334,42,4003,215,2028,6746,1045,8291,5653,17456,254,4,227,5350,8071,231,12869,3,361,11,1026,15268,34,5,72,6282,12798,15,1262,70,7,1,1,1580,28,8,8,4,3,1,1,1,11,352,1,1,668,733,107,17,269,5,14,8285,2002,1190,42,13034,1788,185,1576,273,711,2,199,28,2095,131,1518,126,16928,957,193,144,909,4458,7900,1,5,29,30,1807,21,5,383,81,149,6,3,6,3,82,255,5,5,6,67,446,76,11,1391,1,4,1392,1181,790,138,13734,1485,16,52,269,725,3939,545,15817,1166,445,9962,6856,186,1199,12,440,502,3562,162,2,109,2056,69,40,199,1,4,1293,16,11,118,394,14,140,11,4,17,6,16,5,30,80,10,1,36,2],[0.2290740150135,0.159339362658787,0.137417263094512,0.137417263094512,0.119072929085184,0.0714274167447929,0.116048743298192,0.0442881294946682,0.196200611721167,0.196200611721167,0.117380821110661,0.0907006038184301,0.225452013924729,0.117380821110661,0.0651711789618038,0.0743625327735687,0.0437194391128621,0.0907006038184301,0.0713836238697473,0.0812044152138672,0.051970264919825,0.0346260570246458,0.12348571700753,0.0809384928109641,0.0403324182234465,0.047725312670047,0.280738221883034,0.170472101825147,0.0992445375855373,0.115895161761336,0.0728485804832907,0.050512351013965,0.283930566613291,0.193923627172572,0.149276478199995,0.129144654569753,0.111988362085457,0.0956405792951736,0.0586275774492627,0.173204873759835,0.11578985249949,0.0693545964006394,0.0515528358123268,0.138817580448124,0.204994989260004,0.179264856193018,0.179264856193018,0.179264856193018,0.288007551975715,0.155989186234724,0.155989186234724,0.119605896323718,0.116048743298192,0.0522533851347467,0.0505842461321365,0.225452013924729,0.132888790146474,0.100541025718577,0.0890524997203714,0.0651711789618038,0.0369230147951608,0.0369230147951608,0.0322694893745914,0.178052738551561,0.228989915928714,0.204917380474179,0.103095400598943,0.0664095295348987,0.0664095295348987,0.0445696080939738,0.214033263799995,0.0837947589384704,0.0713836238697473,0.0953447840569228,0.0410176872286399,0.0302529307452587,0.0357884697132944,0.241897342427964,0.12348571700753,0.12348571700753,0.068772265858596,0.0416781256362965,0.0416781256362965,0.147000263131555,0.170472101825147,0.0728485804832907,0.0577640577141433,0.193923627172572,0.167876278272588,0.0986419836270165,0.0669621663738019,0.178160880627989,0.19988040148686,0.137448378337001,0.155141584416422,0.102042486124113,0.102042486124113,0.0588181615570141,0.328741951549051,0.291597538644945,0.0714274167447929,0.081424260308675,0.227821456403885,0.227821456403885,0.151536219599478,0.10043154925051,0.088325478791516,0.225452013924729,0.17512306703046,0.199397657356577,0.178052738551561,0.228989915928714,0.135227744343042,0.135227744343042,0.11593041756729,0.0643188863934918,0.0376462233107455,0.0445696080939738,0.0445696080939738,0.214033263799995,0.185907795047495,0.110653714305772,0.107330346499594,0.0837947589384704,0.0592907412703972,0.0592907412703972,0.0357884697132944,0.0357884697132944,0.216849546381328,0.143836056788051,0.0967916710895032,0.0709966796604125,0.060356239826671,0.0403324182234465,0.0416781256362965,0.0416781256362965,0.130351093820295,0.115895161761336,0.0488959569335465,0.313623790468481,0.167876278272588,0.129144654569753,0.111988362085457,0.178160880627989,0.178160880627989,0.173204873759835,0.137448378337001,0.178122452230472,0.2290740150135,0.199473700118742,0.179264856193018,0.115529546818843,0.081424260308675,0.175583239581624,0.13445428872491,0.13536275039074,0.13536275039074,0.0752984341535525,0.0442881294946682,0.196200611721167,0.0631168848064616,0.100541025718577,0.113881283269001,0.0863149357187416,0.0743625327735687,0.0553518007846355,0.0381594893981419,0.135227744343042,0.103095400598943,0.0643188863934918,0.214033263799995,0.125399192181097,0.125399192181097,0.0713836238697473,0.0346260570246458,0.143836056788051,0.10991822950727,0.0938407052753943,0.0809384928109641,0.068772265858596,0.280738221883034,0.253010826871242,0.147000263131555,0.130351093820295,0.0854909718186668,0.0828529348606328,0.283930566613291,0.129144654569753,0.133042809263103,0.0842339523410123,0.0956405792951736,0.0669621663738019,0.19988040148686,0.154124042447556,0.154124042447556,0.173204873759835,0.102042486124113,0.0607416142463566,0.0693545964006394,0.36076050519035,0.2290740150135,0.2290740150135,0.199473700118742,0.137417263094512,0.115529546818843,0.134770318338199,0.259821546505191,0.253294053512045,0.175583239581624,0.10248395038726,0.10248395038726,0.0752984341535525,0.0597393138940654,0.0505842461321365,0.0597393138940654,0.178052738551561,0.201654125614921,0.113881283269001,0.0863149357187416,0.0863149357187416,0.0553518007846355,0.0322694893745914,0.119484433902615,0.0879172651441298,0.0773529765281194,0.191143247225869,0.094675487414599,0.110653714305772,0.0713836238697473,0.0699055442783588,0.0592907412703972,0.0612286427395195,0.0302529307452587,0.211093748212825,0.0826291280627058,0.10991822950727,0.0967916710895032,0.0809384928109641,0.130351093820295,0.0992445375855373,0.115895161761336,0.0854909718186668,0.0854909718186668,0.0488959569335465,0.149276478199995,0.172711665007486,0.193923627172572,0.150267701521805,0.150267701521805,0.0986419836270165,0.0669621663738019,0.0669621663738019,0.0497416667621874,0.0497416667621874,0.155141584416422,0.133441008786059,0.11578985249949,0.0871858077098534,0.0607416142463566,0.0515528358123268,0.156655028105866,0.138817580448124,0.204994989260004,0.102018437997048,0.0691905125399858,0.0714274167447929,0.0607266411664894,0.13445428872491,0.175583239581624,0.13536275039074,0.201654125614921,0.119484433902615,0.0664095295348987,0.113881283269001,0.117380821110661,0.132888790146474,0.113881283269001,0.0651711789618038,0.0381594893981419,0.0381594893981419,0.199397657356577,0.102377853724816,0.0564148282459148,0.0643188863934918,0.0664095295348987,0.0329046638009983,0.191143247225869,0.214033263799995,0.0953447840569228,0.0592907412703972,0.0699055442783588,0.0346260570246458,0.241897342427964,0.0938407052753943,0.060356239826671,0.047725312670047,0.0403324182234465,0.246597434041289,0.0972499813205466,0.0728485804832907,0.0828529348606328,0.0972499813205466,0.0428005049638785,0.193923627172572,0.149276478199995,0.114246941753198,0.0956405792951736,0.0497416667621874,0.0567670222194393,0.0567670222194393,0.321789594631143,0.19988040148686,0.0871858077098534,0.0607416142463566,0.0588181615570141,0.199473700118742,0.119072929085184,0.115529546818843,0.0607266411664894,0.081424260308675,0.227821456403885,0.13445428872491,0.151536219599478,0.10248395038726,0.116048743298192,0.119605896323718,0.088325478791516,0.0856081638223125,0.088325478791516,0.10043154925051,0.0522533851347467,0.0389059382780151,0.196200611721167,0.132888790146474,0.0759271576867208,0.0553518007846355,0.0553518007846355,0.0437194391128621,0.0369230147951608,0.228989915928714,0.11593041756729,0.0907006038184301,0.103095400598943,0.103095400598943,0.0445696080939738,0.0389059382780151,0.107330346499594,0.051970264919825,0.0410176872286399,0.241897342427964,0.127238016803361,0.10991822950727,0.0938407052753943,0.0826291280627058,0.068772265858596,0.0352649290296753,0.0403324182234465,0.280738221883034,0.246597434041289,0.221598426886998,0.170472101825147,0.147000263131555,0.151343714126521,0.130351093820295,0.112434274358868,0.0428005049638785,0.0577640577141433,0.172711665007486,0.133042809263103,0.0842339523410123,0.0567670222194393,0.137448378337001,0.11578985249949,0.204994989260004,0.178122452230472,0.154808301340302,0.154808301340302,0.154808301340302,0.102018437997048,0.134770318338199,0.081424260308675,0.0691905125399858,0.0691905125399858,0.288007551975715,0.151536219599478,0.116048743298192,0.10043154925051,0.0597393138940654,0.100541025718577,0.0890524997203714,0.0743625327735687,0.11593041756729,0.0773529765281194,0.0879172651441298,0.0643188863934918,0.0329046638009983,0.0389059382780151,0.191143247225869,0.165708037238208,0.094675487414599,0.107330346499594,0.094675487414599,0.0812044152138672,0.0953447840569228,0.0837947589384704,0.051970264919825,0.0410176872286399,0.241897342427964,0.216849546381328,0.127238016803361,0.109158975031619,0.109158975031619,0.109158975031619,0.0826291280627058,0.0709966796604125,0.0352649290296753,0.280738221883034,0.151343714126521,0.170472101825147,0.115895161761336,0.0992445375855373,0.112434274358868,0.0828529348606328,0.0828529348606328,0.172711665007486,0.149276478199995,0.133042809263103,0.114246941753198,0.0842339523410123,0.0586275774492627,0.0567670222194393,0.0497416667621874,0.133441008786059,0.155141584416422,0.133441008786059,0.11578985249949,0.0989489723196936,0.0693545964006394,0.0515528358123268,0.36076050519035,0.321234430220895,0.154808301340302,0.102018437997048,0.0607266411664894,0.259821546505191,0.259821546505191,0.13445428872491,0.119605896323718,0.0752984341535525,0.10043154925051,0.0856081638223125,0.0522533851347467,0.0597393138940654,0.0442881294946682,0.17512306703046,0.0890524997203714,0.201654125614921,0.101247150733422,0.0631168848064616,0.0437194391128621,0.228989915928714,0.199397657356577,0.102377853724816,0.0773529765281194,0.0879172651441298,0.0773529765281194,0.185907795047495,0.125399192181097,0.0699055442783588,0.0699055442783588,0.188792042737369,0.188792042737369,0.143836056788051,0.060356239826671,0.0352649290296753,0.151343714126521,0.1312360351602,0.1312360351602,0.112434274358868,0.050512351013965,0.0577640577141433,0.167876278272588,0.0986419836270165,0.0986419836270165,0.173204873759835,0.154124042447556,0.118114902865569,0.0989489723196936,0.0887328619388452,0.328741951549051,0.178122452230472,0.199473700118742,0.159339362658787,0.134770318338199,0.0607266411664894,0.0505842461321365,0.0357884697132944,0.100541025718577,0.0759271576867208,0.0863149357187416,0.101247150733422,0.0759271576867208,0.0759271576867208,0.0631168848064616,0.0322694893745914,0.0369230147951608,0.0907006038184301,0.0564148282459148,0.0757613787811322,0.0376462233107455,0.0389059382780151,0.0329046638009983,0.165708037238208,0.094675487414599,0.125399192181097,0.0953447840569228,0.051970264919825,0.0410176872286399,0.211093748212825,0.127238016803361,0.127238016803361,0.0967916710895032,0.0809384928109641,0.0352649290296753,0.151343714126521,0.0992445375855373,0.1312360351602,0.0972499813205466,0.0428005049638785,0.0577640577141433,0.0428005049638785,0.050512351013965,0.313623790468481,0.172711665007486,0.111988362085457,0.0586275774492627,0.118114902865569,0.118114902865569,0.0871858077098534,0.0588181615570141,0.0588181615570141,0.105936727526042,0.36076050519035,0.178122452230472,0.159339362658787,0.0691905125399858,0.253294053512045,0.175583239581624,0.155989186234724,0.0856081638223125,0.0856081638223125,0.0442881294946682,0.178052738551561,0.225452013924729,0.117380821110661,0.0890524997203714,0.101247150733422,0.204917380474179,0.135227744343042,0.0757613787811322,0.0564148282459148,0.0329046638009983,0.0376462233107455,0.0376462233107455,0.185907795047495,0.0812044152138672,0.0837947589384704,0.0612286427395195,0.0346260570246458,0.0302529307452587,0.0826291280627058,0.10991822950727,0.0967916710895032,0.0709966796604125,0.060356239826671,0.0709966796604125,0.047725312670047,0.047725312670047,0.221598426886998,0.253010826871242,0.147000263131555,0.112434274358868,0.0972499813205466,0.0488959569335465,0.313623790468481,0.150267701521805,0.133042809263103,0.111988362085457,0.133441008786059,0.0989489723196936,0.137417263094512,0.102018437997048,0.134770318338199,0.119072929085184,0.288007551975715,0.253294053512045,0.288007551975715,0.151536219599478,0.13536275039074,0.10248395038726,0.0752984341535525,0.0505842461321365,0.0651711789618038,0.17512306703046,0.132888790146474,0.101247150733422,0.0743625327735687,0.0631168848064616,0.0322694893745914,0.0437194391128621,0.199397657356577,0.204917380474179,0.102377853724816,0.11593041756729,0.119484433902615,0.102377853724816,0.119484433902615,0.0879172651441298,0.0564148282459148,0.0757613787811322,0.0757613787811322,0.107330346499594,0.110653714305772,0.110653714305772,0.0812044152138672,0.0612286427395195,0.0612286427395195,0.0302529307452587,0.216849546381328,0.12348571700753,0.143836056788051,0.109158975031619,0.0938407052753943,0.068772265858596,0.246597434041289,0.253010826871242,0.1312360351602,0.0728485804832907,0.0854909718186668,0.0488959569335465,0.050512351013965,0.167876278272588,0.150267701521805,0.114246941753198,0.129144654569753,0.114246941753198,0.0842339523410123,0.0956405792951736,0.154124042447556,0.19988040148686,0.155141584416422,0.0871858077098534,0.0989489723196936,0.0693545964006394,0.0515528358123268],[0.129127805433127,0.532100721552132,0.505135244356223,0.505135244356223,0.615953268249703,0.777202361412576,0.814385454992285,0.8794304140101,0.634602081362109,0.634602081362109,0.625036423992238,0.599055904133808,0.157525022668393,0.625036423992238,0.762754888877172,0.364382074477015,0.554936154970593,0.599055904133808,0.484820484731252,0.634561128016334,0.570303710244366,0.841934365760668,0.418113278488668,0.12983342440082,0.750890721884759,0.245010571276101,0.0269210731376157,0.0421259354648359,0.232398269573217,0.252225035279084,0.299224945562149,0.508518352591634,0.126689900370214,0.0394950878952075,0.171492939155961,0.343107362576723,0.0734800986491206,0.42417686096931,0.491712418015502,0.407219852031515,0.124839394170027,0.236791841108606,0.609652120931167,0.449005237787041,0.454016550328853,0.168589368958121,0.168589368958121,0.168589368958121,0.178499445807697,0.659528454562346,0.659528454562346,0.725961487964404,0.814385454992285,0.890424589177818,0.930837036181815,0.157525022668393,0.229125352582163,0.599394540146195,0.695088115150917,0.762754888877172,0.920518015053019,0.920518015053019,0.86257394071558,0.381533825601267,0.109170466660018,0.407332205804051,0.210368662197411,0.678166833545769,0.678166833545769,0.449708746932426,0.0791848648545708,0.511823124834998,0.484820484731252,0.157501586220078,0.364455154317197,0.742713549282459,0.762811980466451,0.0464065259259141,0.418113278488668,0.418113278488668,0.580868204698864,0.645389767886702,0.645389767886702,0.290021039801426,0.0421259354648359,0.299224945562149,0.155754686740631,0.0394950878952075,0.276375545317951,0.307851425025117,0.147117408477749,0.293177021671157,0.0688659608716011,0.361936528933065,0.0918538607826334,0.44444487989921,0.44444487989921,0.742388774426232,0.343449817252047,0.319516172771185,0.777202361412576,0.383480608779617,0.522398102097705,0.522398102097705,0.762371755040003,0.399827925044368,0.788857998525912,0.157525022668393,0.484864596270709,0.532336886142778,0.381533825601267,0.109170466660018,0.163045636759864,0.163045636759864,0.644060398314664,0.777281393133829,0.883594998418225,0.449708746932426,0.449708746932426,0.0791848648545708,0.444059364314964,0.433954828457048,0.559417869834488,0.511823124834998,0.710057168654186,0.710057168654186,0.762811980466451,0.762811980466451,0.214407501426405,0.0718045654885272,0.372379561023664,0.455568804250603,0.428926375190985,0.750890721884759,0.645389767886702,0.645389767886702,0.18125716781945,0.252225035279084,0.631489007584717,0.0252148028389481,0.276375545317951,0.343107362576723,0.0734800986491206,0.293177021671157,0.293177021671157,0.407219852031515,0.361936528933065,0.427393636103258,0.129127805433127,0.579343328111123,0.168589368958121,0.726500651678243,0.383480608779617,0.25672817126206,0.634867385327239,0.320819284945982,0.320819284945982,0.770302025296844,0.8794304140101,0.634602081362109,0.841892371647264,0.599394540146195,0.734097923267173,0.790600533519634,0.364382074477015,0.742653252048913,0.874886506088479,0.163045636759864,0.210368662197411,0.777281393133829,0.0791848648545708,0.120259930202896,0.120259930202896,0.484820484731252,0.841934365760668,0.0718045654885272,0.0956726019324114,0.495627950967241,0.12983342440082,0.580868204698864,0.0269210731376157,0.134316750208503,0.290021039801426,0.18125716781945,0.322358679696587,0.440675753990403,0.126689900370214,0.343107362576723,0.239757317068981,0.28532043525046,0.42417686096931,0.147117408477749,0.0688659608716011,0.271299052770578,0.271299052770578,0.407219852031515,0.44444487989921,0.63503721267499,0.236791841108606,0.0853176350022514,0.129127805433127,0.129127805433127,0.579343328111123,0.505135244356223,0.726500651678243,0.222383394735128,0.549262280157236,0.668680618780406,0.25672817126206,0.703952355182634,0.703952355182634,0.770302025296844,0.59166383374878,0.930837036181815,0.59166383374878,0.381533825601267,0.511867252170331,0.734097923267173,0.790600533519634,0.790600533519634,0.742653252048913,0.86257394071558,0.522110112417217,0.712194512196884,0.572851520072568,0.325362284229553,0.407630014647155,0.433954828457048,0.484820484731252,0.208645542555248,0.710057168654186,0.596554316269929,0.742713549282459,0.311304755084877,0.347496939925796,0.0956726019324114,0.372379561023664,0.12983342440082,0.18125716781945,0.232398269573217,0.252225035279084,0.322358679696587,0.322358679696587,0.631489007584717,0.171492939155961,0.187392141090683,0.0394950878952075,0.0532393749650971,0.0532393749650971,0.307851425025117,0.147117408477749,0.147117408477749,0.464760670315568,0.464760670315568,0.0918538607826334,0.484396164861466,0.124839394170027,0.417953580092303,0.63503721267499,0.609652120931167,0.126869246695356,0.449005237787041,0.454016550328853,0.590097587527263,0.852452852337982,0.777202361412576,0.757936368612956,0.634867385327239,0.25672817126206,0.320819284945982,0.511867252170331,0.522110112417217,0.678166833545769,0.734097923267173,0.625036423992238,0.229125352582163,0.734097923267173,0.762754888877172,0.874886506088479,0.874886506088479,0.532336886142778,0.495115185806239,0.654147841708956,0.777281393133829,0.678166833545769,0.804451457756567,0.325362284229553,0.0791848648545708,0.157501586220078,0.710057168654186,0.208645542555248,0.841934365760668,0.0464065259259141,0.495627950967241,0.428926375190985,0.245010571276101,0.750890721884759,0.204437846599107,0.0781904696152396,0.299224945562149,0.440675753990403,0.0781904696152396,0.481518090672775,0.0394950878952075,0.171492939155961,0.220621453988894,0.42417686096931,0.464760670315568,0.615710313285801,0.615710313285801,0.0444575524143837,0.0688659608716011,0.417953580092303,0.63503721267499,0.742388774426232,0.579343328111123,0.615953268249703,0.726500651678243,0.757936368612956,0.383480608779617,0.522398102097705,0.634867385327239,0.762371755040003,0.703952355182634,0.814385454992285,0.725961487964404,0.788857998525912,0.860876462363348,0.788857998525912,0.399827925044368,0.890424589177818,0.820890153876392,0.634602081362109,0.229125352582163,0.671720675372905,0.742653252048913,0.742653252048913,0.554936154970593,0.920518015053019,0.109170466660018,0.644060398314664,0.599055904133808,0.210368662197411,0.210368662197411,0.449708746932426,0.820890153876392,0.559417869834488,0.570303710244366,0.364455154317197,0.0464065259259141,0.30257692437969,0.0956726019324114,0.495627950967241,0.347496939925796,0.580868204698864,0.620294198948607,0.750890721884759,0.0269210731376157,0.204437846599107,0.122243281078951,0.0421259354648359,0.290021039801426,0.197845445886896,0.18125716781945,0.358415697450848,0.481518090672775,0.155754686740631,0.187392141090683,0.239757317068981,0.28532043525046,0.615710313285801,0.361936528933065,0.124839394170027,0.454016550328853,0.427393636103258,0.653194996306794,0.653194996306794,0.653194996306794,0.590097587527263,0.222383394735128,0.383480608779617,0.852452852337982,0.852452852337982,0.178499445807697,0.762371755040003,0.814385454992285,0.399827925044368,0.59166383374878,0.599394540146195,0.695088115150917,0.364382074477015,0.644060398314664,0.572851520072568,0.712194512196884,0.777281393133829,0.804451457756567,0.820890153876392,0.325362284229553,0.302109097262961,0.407630014647155,0.559417869834488,0.407630014647155,0.634561128016334,0.157501586220078,0.511823124834998,0.570303710244366,0.364455154317197,0.0464065259259141,0.214407501426405,0.30257692437969,0.280275646968438,0.280275646968438,0.280275646968438,0.347496939925796,0.455568804250603,0.620294198948607,0.0269210731376157,0.197845445886896,0.0421259354648359,0.252225035279084,0.232398269573217,0.358415697450848,0.440675753990403,0.440675753990403,0.187392141090683,0.171492939155961,0.239757317068981,0.220621453988894,0.28532043525046,0.491712418015502,0.615710313285801,0.464760670315568,0.484396164861466,0.0918538607826334,0.484396164861466,0.124839394170027,0.569887335195842,0.236791841108606,0.609652120931167,0.0853176350022514,0.464205130343863,0.653194996306794,0.590097587527263,0.757936368612956,0.549262280157236,0.549262280157236,0.634867385327239,0.725961487964404,0.770302025296844,0.399827925044368,0.860876462363348,0.890424589177818,0.59166383374878,0.8794304140101,0.484864596270709,0.695088115150917,0.511867252170331,0.289004924144916,0.841892371647264,0.554936154970593,0.109170466660018,0.532336886142778,0.495115185806239,0.572851520072568,0.712194512196884,0.572851520072568,0.444059364314964,0.120259930202896,0.208645542555248,0.208645542555248,0.196771221889457,0.196771221889457,0.0718045654885272,0.428926375190985,0.620294198948607,0.197845445886896,0.0567316817120032,0.0567316817120032,0.358415697450848,0.508518352591634,0.155754686740631,0.276375545317951,0.307851425025117,0.307851425025117,0.407219852031515,0.271299052770578,0.337376610698367,0.569887335195842,0.218903715094739,0.343449817252047,0.427393636103258,0.579343328111123,0.532100721552132,0.222383394735128,0.757936368612956,0.930837036181815,0.762811980466451,0.599394540146195,0.671720675372905,0.790600533519634,0.289004924144916,0.671720675372905,0.671720675372905,0.841892371647264,0.86257394071558,0.920518015053019,0.599055904133808,0.654147841708956,0.273114561699877,0.883594998418225,0.820890153876392,0.804451457756567,0.302109097262961,0.407630014647155,0.120259930202896,0.157501586220078,0.570303710244366,0.364455154317197,0.311304755084877,0.30257692437969,0.30257692437969,0.372379561023664,0.12983342440082,0.620294198948607,0.197845445886896,0.232398269573217,0.0567316817120032,0.0781904696152396,0.481518090672775,0.155754686740631,0.481518090672775,0.508518352591634,0.0252148028389481,0.187392141090683,0.0734800986491206,0.491712418015502,0.337376610698367,0.337376610698367,0.417953580092303,0.742388774426232,0.742388774426232,0.527059536323731,0.0853176350022514,0.427393636103258,0.532100721552132,0.852452852337982,0.668680618780406,0.25672817126206,0.659528454562346,0.860876462363348,0.860876462363348,0.8794304140101,0.381533825601267,0.157525022668393,0.625036423992238,0.695088115150917,0.289004924144916,0.407332205804051,0.163045636759864,0.273114561699877,0.654147841708956,0.804451457756567,0.883594998418225,0.883594998418225,0.444059364314964,0.634561128016334,0.511823124834998,0.596554316269929,0.841934365760668,0.742713549282459,0.347496939925796,0.0956726019324114,0.372379561023664,0.455568804250603,0.428926375190985,0.455568804250603,0.245010571276101,0.245010571276101,0.122243281078951,0.134316750208503,0.290021039801426,0.358415697450848,0.0781904696152396,0.631489007584717,0.0252148028389481,0.0532393749650971,0.239757317068981,0.0734800986491206,0.484396164861466,0.569887335195842,0.505135244356223,0.590097587527263,0.222383394735128,0.615953268249703,0.178499445807697,0.668680618780406,0.178499445807697,0.762371755040003,0.320819284945982,0.703952355182634,0.770302025296844,0.930837036181815,0.762754888877172,0.484864596270709,0.229125352582163,0.289004924144916,0.364382074477015,0.841892371647264,0.86257394071558,0.554936154970593,0.532336886142778,0.407332205804051,0.495115185806239,0.644060398314664,0.522110112417217,0.495115185806239,0.522110112417217,0.712194512196884,0.654147841708956,0.273114561699877,0.273114561699877,0.559417869834488,0.433954828457048,0.433954828457048,0.634561128016334,0.596554316269929,0.596554316269929,0.742713549282459,0.214407501426405,0.418113278488668,0.0718045654885272,0.280275646968438,0.495627950967241,0.580868204698864,0.204437846599107,0.134316750208503,0.0567316817120032,0.299224945562149,0.322358679696587,0.631489007584717,0.508518352591634,0.276375545317951,0.0532393749650971,0.220621453988894,0.343107362576723,0.220621453988894,0.28532043525046,0.42417686096931,0.271299052770578,0.0688659608716011,0.0918538607826334,0.417953580092303,0.569887335195842,0.236791841108606,0.609652120931167]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>segmento<\/th>\n      <th>n<\/th>\n      <th>Apredict<\/th>\n      <th>Bpredict<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="auc" class="section level3">
<h3>AUC</h3>
<p>Si calculamos el AUC con las librerías normales no se va a tener en cuenta que tenemos datos agrupados, sino que considera cada fila como una observación. En este caso los AUC’s son como si fuera un modelo aleatorio.</p>
<pre class="r"><code>pROC::auc(test_local$segmento==&quot;Best&quot;, test_local$Apredict)</code></pre>
<pre><code>## Area under the curve: 0.5035</code></pre>
<pre class="r"><code>pROC::auc(test_local$segmento==&quot;No_way&quot;, test_local$Bpredict)</code></pre>
<pre><code>## Area under the curve: 0.4979</code></pre>
<p>Con los datos agregados se tiene por ejemplo que si en una fila n vale 1000 y la probabilidad de A es 0.2, la estimación de gente en segmento “Best” sería de 200, y podríamos calcular un test de bondad de ajuste de la Chi de Pearson, para comparar la frecuencia observada con la esperada.</p>
<p><span class="math display">\[\chi^2 = \sum_i\dfrac{(observada_i- estimada_i)^2}{estimada_i}\]</span></p>
<pre class="r"><code>test_local |&gt; 
  filter(segmento == &quot;Best&quot; &amp; n &gt; 100) |&gt; 
  select(segmento, n, Apredict) |&gt; 
  arrange( - Apredict) |&gt; 
  mutate(A_estimate_num = Apredict * n) |&gt; 
  DT::datatable()</code></pre>
<div id="htmlwidget-4" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-4">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75"],["Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best","Best"],[102,313,183,427,2188,505,364,205,383,2626,446,3151,1362,2818,361,3768,324,3939,3590,206,725,171,426,273,1199,3327,186,2897,269,1162,128,298,2319,284,3921,147,2369,2002,191,506,255,107,137,732,131,2456,159,1788,790,193,2470,168,1424,1189,326,262,502,256,1262,111,186,131,1495,1956,758,108,1842,978,999,324,2028,317,107,307,215],[0.2290740150135,0.193923627172572,0.179264856193018,0.175583239581624,0.170472101825147,0.155989186234724,0.151536219599478,0.151343714126521,0.150267701521805,0.143836056788051,0.13536275039074,0.135227744343042,0.132888790146474,0.1312360351602,0.127238016803361,0.125399192181097,0.119605896323718,0.119484433902615,0.117380821110661,0.116048743298192,0.11593041756729,0.115895161761336,0.113881283269001,0.111988362085457,0.110653714305772,0.10991822950727,0.107330346499594,0.103095400598943,0.102377853724816,0.101247150733422,0.100541025718577,0.10043154925051,0.0972499813205466,0.0967916710895032,0.0953447840569228,0.094675487414599,0.0907006038184301,0.0890524997203714,0.088325478791516,0.0879172651441298,0.0863149357187416,0.0856081638223125,0.0854909718186668,0.0837947589384704,0.0812044152138672,0.0809384928109641,0.0773529765281194,0.0757613787811322,0.0743625327735687,0.0709966796604125,0.0699055442783588,0.0669621663738019,0.0664095295348987,0.0651711789618038,0.0643188863934918,0.0631168848064616,0.0612286427395195,0.0597393138940654,0.0577640577141433,0.0564148282459148,0.0522533851347467,0.0505842461321365,0.047725312670047,0.0445696080939738,0.0437194391128621,0.0416781256362965,0.0410176872286399,0.0389059382780151,0.0381594893981419,0.0376462233107455,0.0369230147951608,0.0357884697132944,0.0346260570246458,0.0329046638009983,0.0322694893745914],[23.365549531377,60.6980953050151,32.8054686833224,74.9740433013534,372.992958793421,78.7745390485356,55.1591839342099,31.0254613959368,57.5525296828514,377.713485125422,60.3717866742699,426.102622424925,180.994532179497,369.823147081442,45.9329240660133,472.504156138373,38.7523104088847,470.649185142401,421.397147787272,23.9060411194276,84.049552736285,19.8180726611885,48.5134266725944,30.5728228493297,132.673803452621,365.697949570687,19.9634444489245,298.667375535139,27.5396426519756,117.649189152237,12.8692512919778,29.928601676652,225.522706682347,27.4888345894189,373.846898287194,13.9172966499461,214.869730445861,178.283104440184,16.8701664491796,44.4861361629297,22.0103086082791,9.16007352898743,11.7122631391574,61.3377635429604,10.6377783930166,198.784938343728,12.299123267971,135.461345260664,58.7464008911193,13.7023591744596,172.666694367546,11.2496439507987,94.5671700576958,77.4885317855847,20.9679569642783,16.5366238192929,30.7367786552388,15.2932643568807,72.8982408352488,6.26204593529655,9.71912963506289,6.62653624330988,71.3493424417202,87.1781534318128,33.1393348475494,4.50123756872002,75.5545798751547,38.0500076358988,38.1213299087437,12.1973763526815,74.8798740045861,11.3449448991143,3.7049881016371,10.1017317869065,6.93794021553714]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>segmento<\/th>\n      <th>n<\/th>\n      <th>Apredict<\/th>\n      <th>A_estimate_num<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Pero seguramente, muchos están más acostumbrados a tener un AUC. Podemos tener en cuenta las frecuencias de cada fila usando la librería <code>WeightedROC</code></p>
<pre class="r"><code>library(WeightedROC)
# requiere que la etiqueta esté en 1 y 0 
rocA &lt;- WeightedROC::WeightedROC(test_local$Apredict,
                               ifelse(test_local$segmento== &quot;Best&quot;,1,0),
                               weight = test_local$n)

WeightedROC::WeightedAUC(rocA)</code></pre>
<pre><code>## [1] 0.6419715</code></pre>
<p>Y vemos que el AUC teniendo en cuenta los pesos ya no es tan malo (con tan pocas variables tampoco era esperable un auc de 0.83)</p>
<p>Y para el modeloB</p>
<pre class="r"><code>rocB &lt;- WeightedROC::WeightedROC(test_local$Bpredict,
                               ifelse(test_local$segmento == &quot;No_way&quot;,1,0),
                               weight = test_local$n)

WeightedROC::WeightedAUC(rocB)</code></pre>
<pre><code>## [1] 0.8499705</code></pre>
<p>Y vemos que para el segmento “No_way” nuestro modelo mixto no está mal del todo.</p>
<p>El próximo día, quiza lo haga con <code>Stan</code> usando <code>brms</code> que la sintaxis es bastante sencilla.</p>
</div>
</div>
